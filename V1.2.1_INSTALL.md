# Proxy Relay v1.2.1 安装指南

## 版本信息

- **版本**: v1.2.1
- **发布日期**: 2026-01-12
- **包大小**: 133 KB
- **MD5**: 0a8e9278836b95ddf525847c06490ffa
- **包文件**: proxy-relay-v1.2.1.tar.gz

## 快速安装（从 v1.2.0 升级）

### 一键升级命令

```bash
# 停止服务、解压、更新、重启
sudo systemctl stop proxy-relay && \
cd /tmp && \
tar -xzf proxy-relay-v1.2.1.tar.gz && \
sudo cp -r src/* /opt/proxy-relay/app/src/ && \
sudo systemctl start proxy-relay && \
sudo systemctl status proxy-relay
```

### 分步安装

#### 1. 停止服务

```bash
sudo systemctl stop proxy-relay
```

#### 2. 备份配置（可选但推荐）

```bash
sudo cp /etc/proxy-relay/config.yaml /etc/proxy-relay/config.yaml.v1.2.0
```

#### 3. 上传并解压

```bash
# 上传 proxy-relay-v1.2.1.tar.gz 到服务器 /tmp 目录
cd /tmp
tar -xzf proxy-relay-v1.2.1.tar.gz
```

#### 4. 更新源代码

```bash
sudo cp -r src/* /opt/proxy-relay/app/src/
```

#### 5. 重启服务

```bash
sudo systemctl start proxy-relay
```

#### 6. 验证安装

```bash
# 检查服务状态
sudo systemctl status proxy-relay

# 查看日志
sudo journalctl -u proxy-relay -n 50 --no-pager

# 测试 Web 界面
curl http://localhost:8080/
```

## 新功能验证

### 验证 Reality 支持

1. 访问 Web 界面：`http://your-server:8080`
2. 进入 "出口代理池" 页面
3. 点击 "添加出口代理"
4. 选择协议 "VLESS"
5. 勾选 "启用 TLS"
6. 应该能看到 "启用 Reality" 选项和相关配置字段

### 测试 Reality 配置

使用以下测试链接（示例）：

```
vless://550e8400-e29b-41d4-a716-446655440000@example.com:443?encryption=none&security=reality&sni=www.yahoo.com&pbk=kly0cTgftLELFTNlVKfTD7FgGaM7LIBM6lcm6zUelnw&sid=382d853335&fp=chrome&type=tcp&flow=xtls-rprx-vision#TestReality
```

1. 在 "出口代理池" 页面点击 "链接导入"
2. 粘贴上述链接
3. 点击 "解析"
4. 验证所有 Reality 字段是否正确填充

## 配置示例

### Reality 配置示例（config.yaml）

```yaml
upstream_proxies:
  - id: "reality-proxy-1"
    name: "Reality 出口代理"
    enabled: true
    description: "使用 Reality 协议的 VLESS 代理"
    tags:
      - "reality"
      - "vless"
    proxy:
      server: "example.com"
      port: 443
      protocol: "vless"
      uuid: "550e8400-e29b-41d4-a716-446655440000"
      flow: "xtls-rprx-vision"
      encryption: "none"
      network: "tcp"
      tls: true
      sni: "www.yahoo.com"
      alpn:
        - "h2"
      reality: true
      reality_public_key: "kly0cTgftLELFTNlVKfTD7FgGaM7LIBM6lcm6zUelnw"
      reality_short_id: "382d853335"
      reality_server_name: "www.yahoo.com"
      reality_fingerprint: "chrome"
```

## 回滚到 v1.2.0

如果遇到问题，可以回滚：

```bash
# 停止服务
sudo systemctl stop proxy-relay

# 恢复配置（如果有备份）
sudo cp /etc/proxy-relay/config.yaml.v1.2.0 /etc/proxy-relay/config.yaml

# 重新解压 v1.2.0
cd /tmp
tar -xzf proxy-relay-v1.2.0-final.tar.gz
sudo cp -r src/* /opt/proxy-relay/app/src/

# 重启服务
sudo systemctl start proxy-relay
```

## 故障排除

### 服务无法启动

```bash
# 查看详细日志
sudo journalctl -u proxy-relay -n 100 --no-pager

# 检查配置文件语法
python3 -c "import yaml; yaml.safe_load(open('/etc/proxy-relay/config.yaml'))"
```

### Reality 配置不生效

1. 检查 sing-box 配置：
   ```bash
   cat /var/lib/proxy-relay/singbox_config.json | jq '.outbounds[] | select(.type=="vless")'
   ```

2. 验证 Reality 字段是否存在：
   ```bash
   cat /var/lib/proxy-relay/singbox_config.json | jq '.outbounds[] | select(.type=="vless") | .tls.reality'
   ```

### Web 界面无法访问

```bash
# 检查端口监听
sudo netstat -tlnp | grep 8080

# 检查防火墙
sudo ufw status
```

## 包信息

- **文件名**: `proxy-relay-v1.2.1.tar.gz`
- **大小**: 220 KB
- **MD5**: `b0449d9a74d4741151c0c85eb828727f`
- **包含内容**:
  - 源代码（src/）
  - 测试文件（tests/）
  - 文档（docs/）
  - 脚本（scripts/）
  - 配置示例（config.yaml.example）
  - 服务文件（proxy-relay.service）

## 技术支持

如有问题，请查看：
- 发布说明：`docs/V1.2.1_RELEASE_NOTES.md`
- VLESS 文档：`docs/VLESS_SUPPORT.md`
- 故障排除：`docs/TROUBLESHOOTING.md`

## 下一步

安装完成后，建议：
1. 测试 Reality 配置是否正常工作
2. 更新现有 VLESS 代理以使用 Reality
3. 查看 `docs/V1.2.1_RELEASE_NOTES.md` 了解详细功能
