# 部署后配置指南

## 🎉 恭喜！服务已成功部署

你的 proxy-relay 服务已经成功运行。现在需要通过 Web 界面完成初始配置。

## 📋 快速配置步骤

### 1. 访问 Web 管理界面

在浏览器中访问：
```
http://你的服务器IP:8080
```

### 2. 使用默认凭据登录

- **用户名**: `admin`
- **密码**: `admin123`

⚠️ **重要**: 首次登录后请立即修改密码！

### 3. 修改管理员密码

1. 登录后，点击左侧菜单的 **"系统设置"**
2. 在 **"修改密码"** 部分：
   - 输入当前密码：`admin123`
   - 输入新密码（至少6个字符）
   - 确认新密码
3. 点击 **"修改密码"** 按钮
4. 密码修改成功后，请记住新密码

### 4. 配置 API 提供商

1. 点击左侧菜单的 **"API提供商"**
2. 你会看到一个默认的测试 API 提供商（已禁用）
3. 点击 **"编辑"** 按钮修改配置：
   - **名称**: 给提供商起个名字
   - **启用**: 勾选启用
   - **API端点**: 输入你的代理API地址
   - **请求方法**: 选择 GET 或 POST
   - **响应格式**: 配置如何解析API返回的代理信息
4. 点击 **"保存"** 按钮
5. 点击 **"测试连接"** 验证配置是否正确

### 5. 添加代理配置

1. 点击左侧菜单的 **"代理管理"**
2. 点击 **"添加代理"** 按钮
3. 填写代理配置：
   - **本地端口**: 选择一个端口（如 10808）
   - **代理名称**: 给代理起个名字
   - **API提供商**: 选择刚才配置的提供商
   - **启用监控**: 勾选以启用自动健康检查和故障切换
4. 点击 **"保存"** 按钮

### 6. 启动监控（可选）

如果你启用了监控功能：

1. 点击左侧菜单的 **"监控控制"**
2. 找到你的代理，点击 **"启动监控"** 按钮
3. 系统会自动检查代理健康状态
4. 当代理失败时，会自动从API获取新代理并切换

### 7. 验证 sing-box 服务

配置完代理后，sing-box 服务应该会自动启动：

```bash
# 检查 sing-box 服务状态
sudo systemctl status sing-box

# 如果未运行，手动启动
sudo systemctl start sing-box
```

### 8. 测试代理连接

使用配置的本地端口测试代理：

```bash
# 测试 SOCKS5 代理
curl -x socks5://127.0.0.1:10808 https://www.google.com

# 或使用 wget
wget -e use_proxy=yes -e http_proxy=127.0.0.1:10808 https://www.google.com
```

## 🔧 配置示例

### API 提供商配置示例

**JSON 格式响应**:
```json
{
  "code": 200,
  "data": {
    "ip": "1.2.3.4",
    "port": 1080,
    "username": "user",
    "password": "pass"
  }
}
```

配置：
- 响应格式类型: `json`
- 成功状态码: `200`
- 成功字段: `code`
- 成功值: `200`
- 数据路径: `data`
- IP字段: `ip`
- 端口字段: `port`
- 用户名字段: `username`
- 密码字段: `password`

**纯文本格式响应**:
```
1.2.3.4:1080:user:pass
```

配置：
- 响应格式类型: `text`
- 分隔符: `:`
- 字段顺序: IP, 端口, 用户名, 密码

## 📊 监控参数说明

在 **"系统设置"** 页面可以调整监控参数：

- **检查间隔**: 健康检查的时间间隔（秒）
- **失败阈值**: 连续失败多少次后触发切换
- **检查超时**: 单次健康检查的超时时间（秒）
- **检查URL**: 用于测试代理连接的目标URL

## 🔍 查看历史记录

点击 **"历史记录"** 可以查看：
- 代理切换历史
- 切换原因（手动/自动）
- 切换时间
- 新旧代理信息

## ⚠️ 常见问题

### sing-box 服务未启动

**原因**: 还没有配置任何代理

**解决**: 按照上述步骤添加至少一个代理配置

### 无法访问 Web 界面

**检查防火墙**:
```bash
# 开放 8080 端口
sudo ufw allow 8080/tcp
# 或
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### API 提供商测试失败

**检查**:
1. API 端点地址是否正确
2. 网络连接是否正常
3. 响应格式配置是否匹配实际返回的数据
4. 查看日志: `sudo journalctl -u proxy-relay -f`

### 代理连接失败

**检查**:
1. sing-box 服务是否运行
2. 本地端口是否被占用
3. 上游代理信息是否正确
4. 使用 **"测试代理"** 功能验证连接

## 📝 下一步

1. ✅ 修改默认密码
2. ✅ 配置 API 提供商
3. ✅ 添加代理配置
4. ✅ 启用监控（可选）
5. ✅ 测试代理连接
6. 📖 阅读完整文档: `/docs/README.md`

## 🆘 需要帮助？

- 查看日志: `sudo journalctl -u proxy-relay -f`
- 运行诊断: `sudo /opt/proxy-relay/scripts/diagnose.sh`
- 查看故障排除文档: `/docs/TROUBLESHOOTING.md`

---

**祝使用愉快！** 🚀
