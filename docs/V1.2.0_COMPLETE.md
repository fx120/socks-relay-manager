# v1.2.0 å¼€å‘å®ŒæˆæŠ¥å‘Š

## ğŸ‰ å¼€å‘çŠ¶æ€ï¼šå·²å®Œæˆ

v1.2.0 å‡ºå£ä»£ç†æ± æ¶æ„å·²å…¨éƒ¨å¼€å‘å®Œæˆï¼ŒåŒ…æ‹¬åç«¯ APIã€Web å‰ç«¯ç•Œé¢ã€æµ‹è¯•å’Œæ–‡æ¡£ã€‚

---

## âœ… å®Œæˆæ¸…å•

### 1. æ ¸å¿ƒåŠŸèƒ½ âœ…

#### æ•°æ®æ¨¡å‹ (`src/proxy_relay/models.py`)
- âœ… æ–°å¢ `UpstreamProxyPool` æ•°æ®ç±»
- âœ… `ProxyConfig` æ–°å¢ `upstream_id` å­—æ®µ
- âœ… `Config` æ–°å¢ `upstream_proxies` åˆ—è¡¨
- âœ… å®Œæ•´çš„æ•°æ®éªŒè¯é€»è¾‘
- âœ… æ”¯æŒ VLESS åè®®å®Œæ•´å­—æ®µ

#### é…ç½®ç®¡ç†å™¨ (`src/proxy_relay/config_manager.py`)
- âœ… è§£æ `upstream_proxies` é…ç½®æ®µ
- âœ… åºåˆ—åŒ–å‡ºå£ä»£ç†æ± åˆ°é…ç½®æ–‡ä»¶
- âœ… æ”¯æŒ VLESS åè®®å­—æ®µ
- âœ… å‘åå…¼å®¹ v1.1.0 æ ¼å¼
- âœ… éªŒè¯ `upstream_id` å¼•ç”¨

#### ä»£ç†ç®¡ç†å™¨ (`src/proxy_relay/proxy_manager.py`)
- âœ… æ–°å¢ `_get_upstream_by_id()` æ–¹æ³•
- âœ… æ›´æ–° `generate_singbox_config()` æ”¯æŒ upstream_id
- âœ… ä¼˜å…ˆä½¿ç”¨ upstream_idï¼Œå…¶æ¬¡ä½¿ç”¨ç›´æ¥é…ç½®
- âœ… æ”¯æŒä»å‡ºå£ä»£ç†æ± è§£æä»£ç†

#### æ•°æ®åº“ (`src/proxy_relay/database.py`)
- âœ… æ–°å¢ `upstream_proxies` è¡¨
- âœ… æ–°å¢ `upstream_usage` è¡¨
- âœ… æ–°å¢ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•
- âœ… åˆ›å»ºç›¸å…³ç´¢å¼•

### 2. Web API âœ…

#### Pydantic æ¨¡å‹ (`src/proxy_relay/web_api.py`)
- âœ… `UpstreamProxyPoolModel`
- âœ… `UpstreamProxyPoolCreateModel`
- âœ… `UpstreamProxyPoolUpdateModel`
- âœ… æ›´æ–° `ProxyConfigModel` æ”¯æŒ `upstream_id`
- âœ… æ›´æ–° `ProxyUpdateModel` æ”¯æŒ `upstream_id`

#### API ç«¯ç‚¹
- âœ… `GET /api/upstream-proxies` - è·å–æ‰€æœ‰å‡ºå£ä»£ç†
- âœ… `POST /api/upstream-proxies` - æ·»åŠ å‡ºå£ä»£ç†
- âœ… `GET /api/upstream-proxies/{id}` - è·å–å•ä¸ªå‡ºå£ä»£ç†
- âœ… `PUT /api/upstream-proxies/{id}` - æ›´æ–°å‡ºå£ä»£ç†
- âœ… `DELETE /api/upstream-proxies/{id}` - åˆ é™¤å‡ºå£ä»£ç†
- âœ… `POST /api/upstream-proxies/{id}/test` - æµ‹è¯•å‡ºå£ä»£ç†
- âœ… æ›´æ–°æœ¬åœ°ä»£ç† API æ”¯æŒ `upstream_id`

### 3. Web å‰ç«¯ç•Œé¢ âœ…

#### å¯¼èˆªèœå• (`src/proxy_relay/web/templates/base.html`)
- âœ… æ–°å¢"å‡ºå£ä»£ç†æ± "èœå•é¡¹
- âœ… æ·»åŠ  v1.2 æ ‡è¯†
- âœ… æ›´æ–°"ä»£ç†ç®¡ç†"ä¸º"æœ¬åœ°ä»£ç†"

#### å‡ºå£ä»£ç†æ± é¡µé¢ (`src/proxy_relay/web/templates/upstream_proxies.html`)
- âœ… å‡ºå£ä»£ç†åˆ—è¡¨å±•ç¤º
- âœ… æ·»åŠ å‡ºå£ä»£ç†åŠŸèƒ½
- âœ… ç¼–è¾‘å‡ºå£ä»£ç†åŠŸèƒ½
- âœ… åˆ é™¤å‡ºå£ä»£ç†åŠŸèƒ½ï¼ˆå¸¦ä½¿ç”¨æ£€æŸ¥ï¼‰
- âœ… æµ‹è¯•å‡ºå£ä»£ç†è¿æ¥
- âœ… æ˜¾ç¤ºä½¿ç”¨ç»Ÿè®¡
- âœ… æ”¯æŒæ ‡ç­¾ç®¡ç†
- âœ… æ”¯æŒ SOCKS5/HTTP/VLESS åè®®
- âœ… VLESS å®Œæ•´é…ç½®æ”¯æŒï¼ˆTCP/WS/gRPC/HTTP2ï¼‰
- âœ… å“åº”å¼è®¾è®¡
- âœ… å®æ—¶é€šçŸ¥

### 4. é…ç½®ç¤ºä¾‹ âœ…

#### æ›´æ–° `config.yaml.example`
- âœ… æ·»åŠ  `upstream_proxies` é…ç½®æ®µç¤ºä¾‹
- âœ… VLESS WebSocket ç¤ºä¾‹
- âœ… VLESS gRPC ç¤ºä¾‹
- âœ… SOCKS5 ç¤ºä¾‹
- âœ… æœ¬åœ°ä»£ç†å¼•ç”¨ç¤ºä¾‹
- âœ… å‘åå…¼å®¹ç¤ºä¾‹
- âœ… ç›´è¿æ¨¡å¼ç¤ºä¾‹

### 5. æµ‹è¯• âœ…

#### å•å…ƒæµ‹è¯• (`tests/test_upstream_proxy_pool.py`)
- âœ… 7 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… æµ‹è¯•åˆ›å»ºå‡ºå£ä»£ç†æ± 
- âœ… æµ‹è¯• VLESS å‡ºå£ä»£ç†æ± 
- âœ… æµ‹è¯•é…ç½®åŒ…å«å‡ºå£ä»£ç†æ± 
- âœ… æµ‹è¯•é…ç½®éªŒè¯
- âœ… æµ‹è¯•æ··åˆä½¿ç”¨æ¨¡å¼
- âœ… æµ‹è¯•æ•°æ®éªŒè¯
- âœ… æµ‹è¯•é‡å¤ ID éªŒè¯

### 6. æ–‡æ¡£ âœ…

- âœ… `docs/UPSTREAM_POOL_ARCHITECTURE.md` - æ¶æ„è®¾è®¡æ–‡æ¡£
- âœ… `docs/V1.2.0_RELEASE_NOTES.md` - å‘å¸ƒè¯´æ˜
- âœ… `docs/V1.2.0_SUMMARY.md` - å¼€å‘æ€»ç»“
- âœ… `docs/V1.2.0_QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… `docs/V1.2.0_COMPLETE.md` - å®ŒæˆæŠ¥å‘Šï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### ä¿®æ”¹çš„æ–‡ä»¶
1. `src/proxy_relay/models.py` - æ–°å¢ UpstreamProxyPoolï¼Œæ›´æ–° ProxyConfig å’Œ Config
2. `src/proxy_relay/config_manager.py` - æ”¯æŒè§£æå’Œåºåˆ—åŒ– upstream_proxies
3. `src/proxy_relay/proxy_manager.py` - æ”¯æŒ upstream_id è§£æ
4. `src/proxy_relay/database.py` - æ–°å¢ upstream_proxies è¡¨å’Œç›¸å…³æ–¹æ³•
5. `src/proxy_relay/web_api.py` - æ–°å¢å‡ºå£ä»£ç†æ±  API ç«¯ç‚¹
6. `src/proxy_relay/web/templates/base.html` - æ›´æ–°å¯¼èˆªèœå•
7. `config.yaml.example` - æ·»åŠ  upstream_proxies ç¤ºä¾‹

### æ–°å¢çš„æ–‡ä»¶
1. `src/proxy_relay/web/templates/upstream_proxies.html` - å‡ºå£ä»£ç†æ± ç®¡ç†é¡µé¢
2. `tests/test_upstream_proxy_pool.py` - å•å…ƒæµ‹è¯•
3. `docs/V1.2.0_RELEASE_NOTES.md` - å‘å¸ƒè¯´æ˜
4. `docs/V1.2.0_SUMMARY.md` - å¼€å‘æ€»ç»“
5. `docs/V1.2.0_QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
6. `docs/V1.2.0_COMPLETE.md` - å®ŒæˆæŠ¥å‘Š

### ä»£ç è¡Œæ•°
- åç«¯ä»£ç ï¼šçº¦ 500+ è¡Œ
- Web å‰ç«¯ï¼šçº¦ 600+ è¡Œ
- æµ‹è¯•ä»£ç ï¼šçº¦ 300+ è¡Œ
- æ–‡æ¡£ï¼šçº¦ 2000+ è¡Œ

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å‡ºå£ä»£ç†æ± ç®¡ç†
- é›†ä¸­ç®¡ç†æ‰€æœ‰å‡ºå£ä»£ç†
- æ¯ä¸ªå‡ºå£ä»£ç†æœ‰å”¯ä¸€ ID
- æ”¯æŒæ ‡ç­¾åˆ†ç±»
- æ˜¾ç¤ºä½¿ç”¨ç»Ÿè®¡
- æ”¯æŒå¯ç”¨/ç¦ç”¨

### 2. çµæ´»çš„å¼•ç”¨æœºåˆ¶
- æœ¬åœ°ä»£ç†é€šè¿‡ `upstream_id` å¼•ç”¨å‡ºå£ä»£ç†
- æ”¯æŒå¤šä¸ªæœ¬åœ°ä»£ç†ä½¿ç”¨åŒä¸€ä¸ªå‡ºå£ä»£ç†
- è½»æ¾åˆ‡æ¢å‡ºå£ä»£ç†
- å‘åå…¼å®¹ç›´æ¥é…ç½®æ–¹å¼

### 3. å®Œæ•´çš„åè®®æ”¯æŒ
- SOCKS5ï¼ˆå¸¦è®¤è¯ï¼‰
- HTTP/HTTPS
- VLESSï¼ˆTCP/WebSocket/gRPC/HTTP2ï¼‰
- å®Œæ•´çš„ TLS/XTLS æ”¯æŒ

### 4. Web ç•Œé¢
- ç›´è§‚çš„åˆ—è¡¨å±•ç¤º
- æ¨¡æ€æ¡†æ·»åŠ /ç¼–è¾‘
- å®æ—¶æµ‹è¯•è¿æ¥
- ä½¿ç”¨æƒ…å†µç»Ÿè®¡
- åˆ é™¤ä¿æŠ¤ï¼ˆæ£€æŸ¥ä½¿ç”¨æƒ…å†µï¼‰

### 5. å‘åå…¼å®¹
- å®Œå…¨å…¼å®¹ v1.1.0 é…ç½®æ ¼å¼
- æ”¯æŒæ··åˆä½¿ç”¨æ–°æ—§æ–¹å¼
- æ— éœ€å¼ºåˆ¶è¿ç§»

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: Web ç•Œé¢ï¼ˆæ¨èï¼‰

1. è®¿é—® `http://localhost:8080/upstream-proxies`
2. ç‚¹å‡»"æ·»åŠ å‡ºå£ä»£ç†"
3. å¡«å†™ä»£ç†ä¿¡æ¯
4. ä¿å­˜ååœ¨æœ¬åœ°ä»£ç†é¡µé¢é€‰æ‹©ä½¿ç”¨

### æ–¹å¼ 2: API

```bash
# æ·»åŠ å‡ºå£ä»£ç†
curl -X POST http://localhost:8080/api/upstream-proxies \
  -H "Content-Type: application/json" \
  -d '{
    "id": "us-node-1",
    "name": "ç¾å›½èŠ‚ç‚¹1",
    "enabled": true,
    "proxy": {
      "server": "us.example.com",
      "port": 443,
      "protocol": "vless",
      "uuid": "...",
      "network": "ws",
      "tls": true
    }
  }'

# åˆ›å»ºæœ¬åœ°ä»£ç†å¹¶å¼•ç”¨
curl -X POST http://localhost:8080/api/proxies \
  -H "Content-Type: application/json" \
  -d '{
    "local_port": 1080,
    "name": "æœ¬åœ°ä»£ç†1",
    "upstream_id": "us-node-1"
  }'
```

### æ–¹å¼ 3: é…ç½®æ–‡ä»¶

ç¼–è¾‘ `/etc/proxy-relay/config.yaml`:

```yaml
upstream_proxies:
  - id: us-node-1
    name: "ç¾å›½èŠ‚ç‚¹1"
    proxy:
      server: us.example.com
      port: 443
      protocol: vless
      uuid: "..."

proxies:
  - local_port: 1080
    name: "æœ¬åœ°ä»£ç†1"
    upstream_id: us-node-1
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

```
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_create_upstream_proxy_pool PASSED
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_create_vless_upstream_proxy_pool PASSED
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_config_with_upstream_proxies PASSED
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_config_validation_invalid_upstream_id PASSED
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_config_with_mixed_upstream_modes PASSED
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_upstream_proxy_pool_validation PASSED
tests/test_upstream_proxy_pool.py::TestUpstreamProxyPool::test_duplicate_upstream_proxy_ids PASSED

7 passed in 0.14s âœ…
```

---

## ğŸ“¦ éƒ¨ç½²å»ºè®®

### ç«‹å³å¯ç”¨
v1.2.0 å·²ç»å®Œå…¨å¯ç”¨ï¼ŒåŒ…æ‹¬ï¼š
- âœ… åç«¯ API å®Œæ•´
- âœ… Web ç•Œé¢å®Œæ•´
- âœ… é…ç½®ç¤ºä¾‹å®Œæ•´
- âœ… æ–‡æ¡£å®Œæ•´
- âœ… æµ‹è¯•é€šè¿‡

### éƒ¨ç½²æ­¥éª¤

1. **å¤‡ä»½å½“å‰é…ç½®**
   ```bash
   cp /etc/proxy-relay/config.yaml /etc/proxy-relay/config.yaml.backup
   ```

2. **æ›´æ–°ä»£ç **
   ```bash
   # æ‹‰å–æœ€æ–°ä»£ç æˆ–è§£å‹æ›´æ–°åŒ…
   git pull origin main
   # æˆ–
   tar -xzf proxy-relay-v1.2.0.tar.gz
   ```

3. **é‡å¯æœåŠ¡**
   ```bash
   sudo systemctl restart proxy-relay
   ```

4. **è®¿é—® Web ç•Œé¢**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8080`
   - åº”è¯¥èƒ½çœ‹åˆ°æ–°çš„"å‡ºå£ä»£ç†æ± "èœå•é¡¹

5. **å¼€å§‹ä½¿ç”¨**
   - æ·»åŠ å‡ºå£ä»£ç†åˆ°ä»£ç†æ± 
   - åˆ›å»ºæœ¬åœ°ä»£ç†å¹¶å¼•ç”¨å‡ºå£ä»£ç†
   - æˆ–ç»§ç»­ä½¿ç”¨æ—§é…ç½®æ ¼å¼ï¼ˆå®Œå…¨å…¼å®¹ï¼‰

---

## ğŸ“ å­¦ä¹ èµ„æº

### å¿«é€Ÿå¼€å§‹
- é˜…è¯» `docs/V1.2.0_QUICKSTART.md`
- æŸ¥çœ‹ `config.yaml.example` ä¸­çš„ç¤ºä¾‹

### æ·±å…¥äº†è§£
- æ¶æ„è®¾è®¡ï¼š`docs/UPSTREAM_POOL_ARCHITECTURE.md`
- å‘å¸ƒè¯´æ˜ï¼š`docs/V1.2.0_RELEASE_NOTES.md`
- å¼€å‘æ€»ç»“ï¼š`docs/V1.2.0_SUMMARY.md`

### API ä½¿ç”¨
- é€šè¿‡ Web ç•Œé¢çš„å¼€å‘è€…å·¥å…·æŸ¥çœ‹ API è°ƒç”¨
- å‚è€ƒå¿«é€Ÿå¼€å§‹æŒ‡å—ä¸­çš„ API ç¤ºä¾‹

---

## ğŸ”® æœªæ¥è®¡åˆ’

v1.3.0 å¯èƒ½åŒ…å«çš„åŠŸèƒ½ï¼š

1. **å‡ºå£ä»£ç†æ± é«˜çº§åŠŸèƒ½**
   - è´Ÿè½½å‡è¡¡
   - è‡ªåŠ¨æ•…éšœè½¬ç§»
   - å¥åº·è¯„åˆ†
   - æ‰¹é‡å¯¼å…¥

2. **æ•°æ®è¿ç§»**
   - è‡ªåŠ¨æ£€æµ‹å¹¶è¿ç§» v1.1.0 é…ç½®
   - é…ç½®æ ¼å¼è½¬æ¢å·¥å…·

3. **ç›‘æ§å¢å¼º**
   - å‡ºå£ä»£ç†æ€§èƒ½ç›‘æ§
   - æµé‡ç»Ÿè®¡
   - ä½¿ç”¨è¶‹åŠ¿åˆ†æ

4. **UI ä¼˜åŒ–**
   - æ‹–æ‹½æ’åº
   - æ‰¹é‡æ“ä½œ
   - é«˜çº§ç­›é€‰

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰å‚ä¸ v1.2.0 å¼€å‘çš„è´¡çŒ®è€…ï¼

---

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬å·**: v1.2.0
- **å‘å¸ƒæ—¥æœŸ**: 2026-01-12
- **å¼€å‘çŠ¶æ€**: âœ… å·²å®Œæˆ
- **æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
- **æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´
- **éƒ¨ç½²çŠ¶æ€**: âœ… å¯ç«‹å³éƒ¨ç½²

---

## ğŸ‰ æ€»ç»“

v1.2.0 å‡ºå£ä»£ç†æ± æ¶æ„å·²å…¨éƒ¨å¼€å‘å®Œæˆï¼

**ä¸»è¦æˆå°±**ï¼š
- âœ… æ ¸å¿ƒæ¶æ„å®Œæ•´å®ç°
- âœ… Web ç•Œé¢åŠŸèƒ½å®Œå–„
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… æµ‹è¯•è¦†ç›–å……åˆ†
- âœ… æ–‡æ¡£è¯¦å°½å®Œæ•´

**å¯ä»¥ç«‹å³**ï¼š
- éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- é€šè¿‡ Web ç•Œé¢ç®¡ç†å‡ºå£ä»£ç†æ± 
- é€šè¿‡ API é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿ
- ç»§ç»­ä½¿ç”¨æ—§é…ç½®æ ¼å¼ï¼ˆæ— éœ€è¿ç§»ï¼‰

**ä¸‹ä¸€æ­¥**ï¼š
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- è§„åˆ’ v1.3.0 åŠŸèƒ½

ğŸŠ **v1.2.0 å¼€å‘åœ†æ»¡å®Œæˆï¼**
