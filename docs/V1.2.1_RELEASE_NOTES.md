# Proxy Relay v1.2.1 发布说明

## 版本信息

- **版本号**: v1.2.1
- **发布日期**: 2026-01-12
- **类型**: 功能增强版本

## 新增功能

### 1. VLESS Reality 协议支持

v1.2.1 版本新增了对 VLESS Reality 协议的完整支持，Reality 是一种更先进的流量伪装技术。

#### Reality 特性

1. **更强的抗检测能力**
   - 使用真实 TLS 握手
   - 流量特征更接近正常 HTTPS 流量
   - 支持多种 uTLS 指纹模拟

2. **新增配置字段**
   - `reality`: 是否启用 Reality（布尔值）
   - `reality_public_key`: Reality 公钥（43 字符）
   - `reality_short_id`: Reality 短 ID（1-16 个十六进制字符）
   - `reality_server_name`: Reality 握手服务器名称
   - `reality_fingerprint`: uTLS 指纹（chrome, firefox, safari, edge, 360, qq, ios, android, random, randomized）

3. **Web 界面增强**
   - 出口代理池管理页面新增 Reality 配置区域
   - 支持通过 UI 配置所有 Reality 参数
   - 提供字段说明和验证

4. **VLESS 链接解析增强**
   - 支持解析包含 Reality 参数的 VLESS URL
   - URL 参数映射：
     - `security=reality` - 启用 Reality
     - `pbk=xxx` - Public Key
     - `sid=xxx` - Short ID
     - `fp=xxx` - Fingerprint
   - 支持 JSON 格式的 Reality 配置导入

5. **sing-box 配置生成**
   - 自动生成 Reality 相关的 TLS 配置
   - 包含 `reality` 和 `utls` 配置块
   - 完全兼容 sing-box 的 Reality 实现

### 2. 出口代理链接导入功能

新增"链接导入"功能，支持直接导入 3x-ui 等工具生成的 VLESS Reality 链接。

#### 链接导入特性

1. **一键导入**
   - 支持粘贴完整的 VLESS URL
   - 自动解析所有配置参数
   - 自动填充表单字段

2. **支持的链接格式**
   ```
   vless://uuid@server:port?type=tcp&encryption=none&security=reality&pbk=xxx&fp=chrome&sni=yahoo.com&sid=xxx&spx=%2F#name
   ```

3. **UI 改进**
   - 添加"手动配置"和"链接导入"切换按钮
   - 链接解析成功后自动切换到手动模式显示配置
   - 提供清晰的成功/失败提示

4. **兼容性**
   - 完全兼容 3x-ui 导出的 Reality 链接
   - 支持所有 Reality 参数的自动识别
   - 向后兼容传统 VLESS TLS 链接

## 技术细节

### 数据模型更新

`UpstreamProxy` 模型新增字段：
```python
reality: bool = False
reality_public_key: Optional[str] = None
reality_short_id: Optional[str] = None
reality_server_name: Optional[str] = None
reality_fingerprint: Optional[str] = None
```

### sing-box 配置示例

```json
{
  "type": "vless",
  "server": "example.com",
  "server_port": 443,
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "flow": "xtls-rprx-vision",
  "tls": {
    "enabled": true,
    "server_name": "www.yahoo.com",
    "reality": {
      "enabled": true,
      "public_key": "kly0cTgftLELFTNlVKfTD7FgGaM7LIBM6lcm6zUelnw",
      "short_id": "382d853335"
    },
    "utls": {
      "enabled": true,
      "fingerprint": "chrome"
    }
  }
}
```

### VLESS Reality URL 示例

```
vless://550e8400-e29b-41d4-a716-446655440000@example.com:443?encryption=none&security=reality&sni=www.yahoo.com&pbk=kly0cTgftLELFTNlVKfTD7FgGaM7LIBM6lcm6zUelnw&sid=382d853335&fp=chrome&type=tcp&flow=xtls-rprx-vision#MyReality
```

## 升级指南

### 从 v1.2.0 升级

1. **停止服务**
   ```bash
   sudo systemctl stop proxy-relay
   ```

2. **备份配置**
   ```bash
   sudo cp /etc/proxy-relay/config.yaml /etc/proxy-relay/config.yaml.backup
   ```

3. **解压并更新**
   ```bash
   cd /tmp
   tar -xzf proxy-relay-v1.2.1.tar.gz
   sudo cp -r src/* /opt/proxy-relay/app/src/
   ```

4. **重启服务**
   ```bash
   sudo systemctl start proxy-relay
   sudo systemctl status proxy-relay
   ```

### 配置兼容性

- ✅ 完全向后兼容 v1.2.0 配置
- ✅ 现有 VLESS 配置无需修改
- ✅ Reality 字段为可选，默认不启用

## 使用示例

### 通过 Web 界面配置 Reality

1. 访问 "出口代理池" 页面
2. 点击 "添加出口代理" 或编辑现有 VLESS 代理
3. 选择协议为 "VLESS"
4. 勾选 "启用 TLS"
5. 勾选 "启用 Reality"
6. 填写 Reality 配置：
   - Public Key: 从服务器获取的公钥
   - Short ID: 从服务器获取的短 ID
   - Server Name: 伪装域名（如 www.yahoo.com）
   - uTLS Fingerprint: 选择浏览器指纹（推荐 chrome）

### 通过链接导入 Reality 配置

1. 复制 VLESS Reality 链接
2. 在 "出口代理池" 页面点击 "链接导入"
3. 粘贴链接并点击 "解析"
4. 系统自动填充所有 Reality 参数
5. 保存配置

## 已知问题

无

## 下一步计划

- v1.2.2: 支持更多 Reality 高级选项
- v1.3.0: 支持 Hysteria2 协议

## 包信息

- **文件名**: `proxy-relay-v1.2.1.tar.gz`
- **大小**: 220 KB
- **MD5**: `b0449d9a74d4741151c0c85eb828727f`

## 参考资料

- [sing-box Reality 文档](https://sing-box.sagernet.org/configuration/shared/tls/#reality)
- [VLESS Reality 协议说明](https://github.com/XTLS/REALITY)
- [uTLS 指纹列表](https://sing-box.sagernet.org/configuration/shared/tls/#utls)
